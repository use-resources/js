export function rand(...e){let[t,n=0]=e.reverse();return Math.floor(Math.random()*(t+1-n)+n)}export function createNodeElement(e){let t=document.createElement("div");t.innerHTML=e;let n=t.children[0]||"";return t.innerHTML="",n}export function createNodeElements(e){let t=document.createElement("div");t.innerHTML=e;let n=[...t.children];return t.innerHTML="",n}export function createObjectElement(e,t,n=!1){return Array.from(e).reduce((e,r)=>(e[r.getAttribute(t)]=r,n&&r.removeAttribute(t),e),{})}export function createNodeFragment(e){let t=document.createElement("div"),n=document.createDocumentFragment();return t.innerHTML=e,n.append(...t.children),n}export function replaceNodeChildren(e,t={}){let n=e=>e instanceof Text||e instanceof String||e instanceof HTMLElement||e instanceof DocumentFragment||"string"==typeof render;return n(e)&&e.querySelectorAll("[replace-node-children]").forEach(e=>{let r=t[e.getAttribute("replace-node-children")];n(r)?(e.removeAttribute("replace-node-children"),e.replaceWith(r),Array.from(e.attributes).forEach(e=>{r.setAttribute(e.name,`${r.getAttribute(e.name)||""} ${e.value}`.trim())})):e.remove()}),e}export function copyToClipboard(e=""){if(navigator.clipboard)navigator.clipboard.writeText(e);else{let t=document.createElement("textarea");t.setAttribute("style","position: fixed; top: 0; left: 0; transform: translate(-100%);"),t.value=e,document.body.append(t),t.select(),document.execCommand("copy"),t.remove()}}export async function resizeCanvasImage(e,t){return new Promise((n,r)=>{if(!Array.isArray(t))return r({status:!1,images:[]});let o=new Image;o.crossOrigin="Anonymous",o.src=e,o.addEventListener("load",()=>{let e=t.map(e=>{let t=document.createElement("canvas"),n=t.getContext("2d"),r=e.both??e.width,i=e.both??e.height;t.width=r,t.height=i;let l=o.width/o.height,a=r/i,u,c,s,d;return l>a?(u=o.height*a,c=o.height,s=(o.width-u)/2,d=0):(u=o.width,c=o.width/a,s=0,d=(o.height-c)/2),n.drawImage(o,s,d,u,c,0,0,r,i),{width:r,height:i,url:e=>t.toDataURL(e||"image/png"),canvas:t}});n({status:!0,images:e})}),o.addEventListener("error",()=>{r({status:!1,images:[]})})})}export function convertSecondsToTime(e){return{hours:Math.floor((e=parseInt(e))/3600),minutes:Math.floor(e%3600/60),seconds:e%60}}export function getPercentage(e,t){return Math.floor(parseInt(e)/parseInt(t)*100)}export function findInt(e,t=1/0){if("string"==typeof e){e=t===1/0?e:e.slice(0,t);let n=parseInt(e.split("").filter(e=>!isNaN(parseInt(e))).join(""));return isNaN(n)?"":n}return""}export function styleElement(e,t){try{return Object.keys(t??{}).forEach(n=>e.style[n]=t[n]),e}catch(n){return e}}export function downloadFile(e,t=""){let n=document.createElement("a");n.style.display="none",n.href=e,n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n)}export function calculateAspectRatio(e,t){let{width:n,height:r}=e,{width:o,height:i}=t;return o&&i||o?{width:o,height:r*(o/n)}:i?{width:n*(i/r),height:i}:{width:n,height:r}}export function socketIO(e,t="socketIO",n=[]){if(window.io){let r=io(e);return Array.from(n).forEach(e=>{r.on(e,n=>{window.dispatchEvent(new CustomEvent(t,{detail:{from:e,data:n}}))})}),r}return null}export function encodeQueryObject(e){return e instanceof Object?Array.from([e]).flat().map(e=>Object.entries(e).map(e=>[encodeURIComponent(e[0]),encodeURIComponent(e[1]),].join("=")).join("&")).join("&"):""}export async function findElementWithRetry(e,t=100){return new Promise((n,r)=>{let o=0,i=setInterval(()=>{let r=document.querySelector(e);(r||++o>t)&&(clearInterval(i),n(r))})})}export function isURL(e){try{return new URL(e),!0}catch(t){return!1}}export function getBase64Size(e){let t=e.replace(/^data:[a-z]+\/[a-z]+;base64,/,""),n=t.length,r=3*n/4-(t.endsWith("==")?2:t.endsWith("=")?1:0);return r}export function imageUrlToCanvas(e){return new Promise((t,n)=>{let r=new Image;r.crossOrigin="Anonymous",r.onload=()=>{let e=document.createElement("canvas");e.width=r.width,e.height=r.height;let n=e.getContext("2d");n.drawImage(r,0,0),t(e)},r.onerror=e=>{n(Error("Failed to load image: "+e.message))},r.src=e})}export function getFileNameWithoutExtension(e){let t=e.split("/").pop(),n=t.split(".");return n.length>1&&n.pop(),n.join(".")}export function toggleOptions(e="",t=[]){let n=t.findIndex(t=>t==e);return t[n+1]||t[0]}export function fetchWebElement(e){return new Promise((t,n)=>{fetch(e).then(e=>e.text()).then(e=>{let n=document.createElement("div");n.innerHTML=e,t(n)}).catch(n)})}export function getDominantColor(e){return new Promise((t,n)=>{let r=new Image;r.crossOrigin="Anonymous",r.src=e.src,r.onload=function(){let e=document.createElement("canvas"),n=e.getContext("2d");e.width=r.width,e.height=r.height,n.drawImage(r,0,0);let o=n.getImageData(0,0,e.width,e.height),i=o.data,l=i.length/4,a=0,u=0,c=0;for(let s=0;s<i.length;s+=4)a+=i[s],u+=i[s+1],c+=i[s+2];a=Math.round(a/l),u=Math.round(u/l),c=Math.round(c/l);let d=((e,t,n)=>{let r=e=>e.toString(16).padStart(2,"0");return`#${r(e)}${r(t)}${r(n)}`})(a,u,c);t(d)},r.onerror=n})}export function getTextColorBasedOnBackground(e){let t=(e=>{let t=e.replace("#","");3===t.length&&(t=t.split("").map(e=>e+e).join(""));let n=parseInt(t.substring(0,2),16),r=parseInt(t.substring(2,4),16),o=parseInt(t.substring(4,6),16);return{r:n,g:r,b:o}})(e),n=(({r:e,g:t,b:n})=>.299*e+.587*t+.114*n)(t);return n>128?"#000000":"#FFFFFF"}export function isBackgroundTooLightForWhiteText(e){let t=(e=>{let t=e.replace("#","");3===t.length&&(t=t.split("").map(e=>e+e).join(""));let n=parseInt(t.substring(0,2),16),r=parseInt(t.substring(2,4),16),o=parseInt(t.substring(4,6),16);return{r:n,g:r,b:o}})(e),n=(({r:e,g:t,b:n})=>.299*e+.587*t+.114*n)(t);return n<240}export function darkenHexColor(e,t=20){let n=parseInt((e=e.replace("#","")).substring(0,2),16),r=parseInt(e.substring(2,4),16),o=parseInt(e.substring(4,6),16);n=Math.max(0,n-t),r=Math.max(0,r-t),o=Math.max(0,o-t);let i=`#${(16777216+(n<<16)+(r<<8)+o).toString(16).slice(1).toUpperCase()}`;return i}export function generateUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}export function callbackTryCatch(e=null,t=null,...n){try{if("function"==typeof e)return e(...n);return e}catch(r){if("function"==typeof t)return t(r);return t}}export function shuffleArray(e=[]){let t=e.slice(),n=[];for(;t.length;){let r=Math.floor(Math.random()*t.length);n.push(t.splice(r,1)[0])}return n}export function generateRandomStringFromArray(e=[],t=null){return Array(parseInt(t)||0).fill(null).map(()=>e[rand(e.length-1)]).join("")}export function observeValue(e){let t={},n=new Map;return Object.defineProperty(t,"_value",{value:e,writable:!0,enumerable:!1,configurable:!1}),Object.defineProperty(t,"value",{get:function(){return this._value},set:function(e){this._value!==e&&(this._value=e,n.forEach(e=>e()))}}),Object.defineProperty(t,"observe",{value(e){let r=Symbol(),o=()=>n.delete(r);return n.set(r,()=>{e(t.value,o)}),e(t.value,o),o},writable:!1,enumerable:!1,configurable:!1}),Object.defineProperty(t,"unobserve",{value:()=>(n.clear(),n.size),writable:!1,enumerable:!1,configurable:!1}),Object.seal(t),t}